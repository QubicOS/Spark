# Планировщик и блокировки

Ядро SparkOS — кооперативный планировщик + маршрутизатор IPC.
Оно не пытается быть “универсальным runtime” и не реализует preemption.

## Fairness и ограничения

- Планирование: round-robin по runnable задачам.
- Один вызов `Kernel.Step()` выполняет **не более одного** шага одной runnable-задачи.
- Задача обязана быстро возвращаться из `Task.Step`; долгие циклы внутри шага ломают fairness.
- Ядро не имеет приоритета/квантов/таймслайсов; политика — ответственность userland.

## Блокировки

**Recv (IPC):**
- `Context.Recv` блокирует задачу, если mailbox пуст.
- `Context.TryRecv` никогда не блокирует.
- Когда в endpoint приходит сообщение, ядро будит все задачи, ожидающие этот endpoint.

**Tick-блокировка:**
- `Context.BlockOnTick` блокирует задачу до следующего `Kernel.Tick()`.
- `Kernel.Tick()` вызывается runtime’ом/верхним уровнем один раз на “внешний тик” (host или baremetal).
- Это не “время” в смысле HAL: ядро не интерпретирует длительности, а лишь принимает внешнее событие.

## Backpressure (очереди)

- Отправка (`SendTo*`/`SendCap*`) не блокирует.
- При переполнении mailbox отправка не доставляется: `SendErrQueueFull`.

